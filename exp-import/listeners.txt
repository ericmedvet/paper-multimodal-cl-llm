$consoleL = ea.l.console(
  functions = + [
    ea.f.quality(of = ea.f.best(); format = "%6.4f")
  ] + (of = (simulation = (environment = (arena = $validationArenas)
  * [ds.e.navigation()])
  * [ds.sat.fromEnvironment(dT = $dT; tRange = $tRange)])
  * [ds.f.simulate(of = ea.f.solution(of = ea.f.best()))])
  * [f.composition(then = $objFun)];
  onlyLast = false
)

$bestSaverL = ea.l.saveForRun(
  path = "./results/final-best.base64";
  overwrite = true;
  of = ea.acc.all(eFunction = ea.f.firsts(); listFunction = f.nTh(n = -1));
  processor = f.toBase64(of = f.each(of = f.subList(from = 0; to = 1; relative = false); mapF = ea.f.genotype()));
  overwrite = true
)

$bestTrajSaverL = ea.l.saveForRun(
  path = "./results/{name}/{startTime}/best-traj-{run.solver.name}-{run.randomGenerator.seed:%04d}.svg";
  of = ea.acc.lastBest();
  processor = ea.f.toImage(
    image = ds.d.navigation();
    of = ds.f.simulate(
     simulation = ds.sat.fromEnvironment(
       environment = ds.e.navigation(arena = m.nth(n = -1; values = $curriculumArenas));
       dT = $dT;
       tRange = $tRange
      );
      of = ea.f.solution()
    );
    type = svg
  )
)

$qPlotL = ea.l.savePlotAndCsvForRun(
  path = "./results/{name}/{startTime}/best-quality.svg";
  plot = ea.plot.single.quality();
  type = svg
)

$valPlotL = ea.l.savePlotAndCsvForRun(
  path = "./results/{name}/{startTime}/best-on-validation.svg";
  plot = ea.plot.single.xyrsRun(ys = (of = (simulation = (environment = (arena = $validationArenas)
  * [ds.e.navigation()])
  * [ds.sat.fromEnvironment(dT = $dT; tRange = $tRange)])
  * [ds.f.simulate(of = ea.f.solution(of = ea.f.best()))])
  * [f.composition(then = $objFun)]
  );
  type = svg
)

$currPlotL = ea.l.savePlotAndCsvForRun(
  path = "./results/{name}/{startTime}/best-on-all-stages.svg";
  plot = ea.plot.single.xyrsRun(ys = (of = (simulation = (environment = (arena = $curriculumArenas)
  * [ds.e.navigation()])
  * [ds.sat.fromEnvironment(dT = $dT; tRange = $tRange)])
  * [ds.f.simulate(of = ea.f.solution(of = ea.f.best()))])
  * [f.composition(then = $objFun)]
  );
  type = svg
)


